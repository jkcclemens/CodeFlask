!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CodeFlask=e()}(this,function(){"use strict";CSS.supports("caret-color","#000");var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function e(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return t[e]})}var i=function(t,e){if(!t)throw Error("CodeFlask expects a parameter which is Element or a String selector");if(!e)throw Error("CodeFlask expects an object containing options as second parameter");if(t.nodeType)this.editorRoot=t;else{var i=document.querySelector(t);i&&(this.editorRoot=i)}this.opts=e,this.startEditor()};return i.prototype.startEditor=function(){this.createWrapper(),this.createTextarea(),this.createPre(),this.createCode(),this.runOptions(),this.listenTextarea(),this.populateDefault(),this.updateCode(this.code)},i.prototype.createWrapper=function(){this.code=this.editorRoot.innerHTML,this.editorRoot.innerHTML="",this.elWrapper=this.createElement("div",this.editorRoot),this.elWrapper.classList.add("codeflask")},i.prototype.createTextarea=function(){this.elTextarea=this.createElement("textarea",this.elWrapper),this.elTextarea.classList.add("codeflask__textarea","codeflask__flatten")},i.prototype.createPre=function(){this.elPre=this.createElement("pre",this.elWrapper),this.elPre.classList.add("codeflask__pre","codeflask__flatten")},i.prototype.createCode=function(){this.elCode=this.createElement("code",this.elPre),this.elCode.classList.add("codeflask__code","language-"+(this.opts.language||"html"))},i.prototype.createLineNumbers=function(){this.elLineNumbers=this.createElement("div",this.elWrapper),this.elLineNumbers.classList.add("codeflask__lines"),this.setLineNumber()},i.prototype.createElement=function(t,e){var i=document.createElement(t);return e.appendChild(i),i},i.prototype.runOptions=function(){this.opts.rtl=this.opts.rtl||!1,this.opts.tabSize=this.opts.tabSize||2,this.opts.enableAutocorrect=this.opts.enableAutocorrect||!1,this.opts.lineNumbers=this.opts.lineNumbers||!1,this.opts.defaultTheme=!1!==this.opts.defaultTheme,!0===this.opts.rtl&&(this.elTextarea.setAttribute("dir","rtl"),this.elPre.setAttribute("dir","rtl")),!1===this.opts.enableAutocorrect&&(this.elTextarea.setAttribute("spellcheck","false"),this.elTextarea.setAttribute("autocapitalize","off"),this.elTextarea.setAttribute("autocomplete","off"),this.elTextarea.setAttribute("autocorrect","off")),this.opts.lineNumbers&&(this.elWrapper.classList.add("codeflask--has-line-numbers"),this.createLineNumbers())},i.prototype.updateLineNumbersCount=function(){for(var t="",e=1;e<=this.lineNumber;e++)t=t+'<span class="codeflask__lines__line">'+e+"</span>";this.elLineNumbers.innerHTML=t},i.prototype.listenTextarea=function(){var t=this;this.elTextarea.addEventListener("input",function(i){t.code=i.target.value,t.elCode.innerHTML=e(i.target.value),t.highlight(),setTimeout(function(){t.runUpdate(),t.setLineNumber()},1)}),this.elTextarea.addEventListener("keydown",function(e){t.handleTabs(e),t.handleSelfClosingCharacters(e),t.handleClosingCharacters(e),t.handleNewLineIndentation(e)}),this.elTextarea.addEventListener("scroll",function(e){t.elPre.style.transform="translate3d(-"+e.target.scrollLeft+"px, -"+e.target.scrollTop+"px, 0)",t.elLineNumbers&&(t.elLineNumbers.style.transform="translate3d(0, -"+e.target.scrollTop+"px, 0)")})},i.prototype.handleTabs=function(t){if(9===t.keyCode){t.preventDefault();t.keyCode;var e=this.elTextarea.selectionStart,i=this.elTextarea.selectionEnd,s=""+this.code.substring(0,e)+" ".repeat(this.opts.tabSize)+this.code.substring(i);this.updateCode(s),this.elTextarea.selectionEnd=i+this.opts.tabSize}},i.prototype.handleSelfClosingCharacters=function(t){var e=t.key,i={"(":")","[":"]","{":"}","<":">"}[e];i&&(this.elTextarea.selectionStart!==this.elTextarea.selectionEnd?(this.surround(e,i),t.preventDefault()):this.closeCharacter(i))},i.prototype.handleClosingCharacters=function(t){var e=t.key;if([")","]","}",">"].includes(e)){var i=this.elTextarea.selectionEnd;if(this.elTextarea.selectionStart===i)this.code.substring(i,i+1)===e&&(t.preventDefault(),this.elTextarea.selectionStart=this.elTextarea.selectionEnd=i+1)}},i.prototype.setLineNumber=function(){this.lineNumber=this.code.split("\n").length,this.opts.lineNumbers&&this.updateLineNumbersCount()},i.prototype.handleNewLineIndentation=function(t){t.keyCode},i.prototype.surround=function(t,e){var i=this.elTextarea.selectionStart,s=this.elTextarea.selectionEnd,a=this.code.substring(0,i),r=this.code.substring(i,s),o=""+a+t+r+e+this.code.substring(s);this.updateCode(o),this.elTextarea.selectionStart=a.length+1,this.elTextarea.selectionEnd=a.length+r.length+1},i.prototype.closeCharacter=function(t){var e=this.elTextarea.selectionStart,i=this.code.substring(e,e+1).trim();if(!i||!/\w/.test(i)){var s=""+this.code.substring(0,e)+t+this.code.substring(e);this.updateCode(s),this.elTextarea.selectionEnd=e}},i.prototype.updateCode=function(t){this.code=t,this.elTextarea.value=t,this.elCode.innerHTML=e(t),this.highlight(),setTimeout(this.runUpdate,1)},i.prototype.updateLanguage=function(t){var e=this.opts.language;this.elCode.classList.remove("language-"+e),this.elCode.classList.add("language-"+t),this.opts.language=t,this.highlight()},i.prototype.populateDefault=function(){this.updateCode(this.code)},i.prototype.highlight=function(){this.highlightCallback&&this.highlightCallback(this)},i.prototype.setHighlightCallback=function(t){if(t&&"[object Function]"!=={}.toString.call(t))throw Error("CodeFlask expects callback of type Function");this.highlightCallback=t},i.prototype.onUpdate=function(t){if(t&&"[object Function]"!=={}.toString.call(t))throw Error("CodeFlask expects callback of type Function");this.updateCallBack=t},i.prototype.getCode=function(){return this.code},i.prototype.runUpdate=function(){this.updateCallBack&&this.updateCallBack(this.code)},i});
